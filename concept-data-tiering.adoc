---
sidebar: sidebar 
permalink: concept-data-tiering.html 
keywords: storage tiering, tier, tiering, data tiering, s3, s3 tiering, capacity, performance, s3 endpoint, fabric pool, fabricpool, s3 bucket, requirement, vpc endpoint, policy, policies, tiering policies, auto, snapshot only, backup, none, cooling period, volume tiering policies, blob, standard, infrequent access, hot, cool, tiering level, storage tier, storage class 
summary: コールドデータを低コストのオブジェクトストレージに自動的に階層化できるため、ストレージコストを削減できます。 
---
= データ階層化の概要
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
使用頻度の低いデータを低コストのオブジェクトストレージに自動的に階層化できるため、ストレージコストを削減できます。アクティブなデータはハイパフォーマンスの SSD または HDD に残り、非アクティブなデータは低コストのオブジェクトストレージに階層化されます。これにより、プライマリストレージのスペースを再利用し、セカンダリストレージを縮小できます。

image:diagram_data_tiering.png["この概念図は、 EBS ストレージに移動中のホットデータと S3 ストレージに移動中の非アクティブデータを示しています。"]

データ階層化は、 FabricPool テクノロジによって実現されます。


NOTE: データの階層化（ FabricPool ）を有効にするために機能ライセンスをインストールする必要はありません。

ifdef::aws[]



== AWS でのデータ階層化

AWS でデータ階層化を有効にすると、 Cloud Volumes ONTAP はホットデータのパフォーマンス階層として EBS 、アクセス頻度の低いデータの大容量階層として AWS S3 を使用します。

高パフォーマンス階層:: パフォーマンス階層には、汎用 SSD （ GP3 または gp2 ）またはプロビジョニングされる IOPS SSD （ io1 ）を使用できます。
+
--
スループット最適化 HDD （ st1 ）を使用している場合、オブジェクトストレージへのデータの階層化は推奨されません。

--
大容量階層:: Cloud Volumes ONTAP システムは、アクセス頻度の低いデータを1つのS3バケットに階層化します。
+
--
BlueXPでは、作業環境ごとに1つのS3バケットが作成され、fabric-pool-_cluster unique identifier_という名前が付けられています。ボリュームごとに異なる S3 バケットが作成されることはありません。

BlueXPはS3バケットを作成する際、次のデフォルト設定を使用します。

* ストレージクラス：Standard
* デフォルトの暗号化：無効
* Block public access：すべてのパブリックアクセスをブロックします
* オブジェクトの所有権：ACLが有効
* バケットのバージョン管理：無効
* オブジェクトロック：無効


--
ストレージクラス:: AWS の階層化データのデフォルトのストレージクラスは _Standard_ です。Standard は、複数の可用性ゾーンにまたがって保存された頻繁にアクセスされるデータに最適です。
+
--
アクセス頻度の低いデータがない場合は、ストレージクラスを次のいずれかに変更することで、ストレージコストを削減できます。_Intelligent Tiering _、_one-Zone低頻度アクセス_、_Standard -低頻度アクセス_、または_S3 Glacier Instant Retrieval。ストレージクラスを変更すると、アクセス頻度の低いデータは Standard ストレージクラスから始まり、 30 日経ってもアクセスされない場合は選択したストレージクラスに移行されます。

データにアクセスするとアクセスコストが高くなるため、ストレージクラスを変更する前にこの点を考慮する必要があります。 https://aws.amazon.com/s3/storage-classes["Amazon S3 ストレージクラスに関する詳細情報"^]。

作業環境の作成時にストレージクラスを選択し、あとでいつでも変更できます。ストレージクラスの変更の詳細については、を参照してください link:task-tiering.html["使用頻度の低いデータを低コストのオブジェクトストレージに階層化"]。

データ階層化のストレージクラスは、システム全体に適用されます。ボリューム単位ではありません。

--


endif::aws[]

ifdef::azure[]



== Azure のデータ階層化

Azure でデータ階層化を有効にすると、 Cloud Volumes ONTAP は、ホットデータ用のパフォーマンス階層として Azure で管理されているディスクを、アクセス頻度の低いデータ用の大容量階層として Azure Blob Storage を使用します。

高パフォーマンス階層:: 高パフォーマンス階層には SSD と HDD があります。
大容量階層:: Cloud Volumes ONTAP システムは、アクセス頻度の低いデータを単一のBLOBコンテナに階層化します。
+
--
BlueXPでは、Cloud Volumes ONTAP の作業環境ごとに1つのコンテナを持つ新しいストレージアカウントが作成されます。ストレージアカウントの名前はランダムです。ボリュームごとに異なるコンテナは作成されません。

BlueXPでは、次の設定でストレージアカウントが作成されます。

* アクセス層：ホット
* パフォーマンス：標準
* 冗長性：ローカル冗長ストレージ（LRS）
* アカウント：StorageV2（汎用v2）
* REST API処理にはセキュアな転送が必要：有効
* ストレージアカウントキーへのアクセス：有効
* TLSの最小バージョン：バージョン1.2
* インフラストラクチャの暗号化:無効


--
ストレージアクセス階層:: Azure の階層化データのデフォルトのストレージアクセス階層は、 _hot_tier です。ホット階層は、大容量階層でアクセス頻度が高いデータに最適です。
+
--
大容量階層のアクセス頻度の低いデータにアクセスする予定がない場合は、_cool_storage階層に変更することでストレージコストを削減できます。ストレージ階層をクールに変更すると、アクセス頻度の低い大容量階層のデータがクールなストレージ階層に直接移動します。

データにアクセスするとアクセスコストが高くなるため、ストレージ階層を変更する前にこの点を考慮する必要があります。 https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-storage-tiers["Azure BLOB ストレージのアクセス階層の詳細については、こちらを参照してください"^]。

作業環境の作成時にストレージ階層を選択し、あとでいつでも変更できます。ストレージ階層の変更の詳細については、を参照してください link:task-tiering.html["使用頻度の低いデータを低コストのオブジェクトストレージに階層化"]。

データ階層化のためのストレージアクセス階層は、システム全体に適用されます。ボリューム単位ではありません。

--


endif::azure[]

ifdef::gcp[]



== Google Cloudのデータ階層化

Google Cloudでデータ階層化を有効にすると、Cloud Volumes ONTAP はホットデータのパフォーマンス階層として永続的ディスクを使用し、アクセス頻度の低いデータの大容量階層としてGoogle Cloud Storageバケットを使用します。

高パフォーマンス階層:: パフォーマンス階層には、 SSD 永続ディスク、分散型永続ディスク、標準の永続ディスクがあります。
大容量階層:: Cloud Volumes ONTAP システムは、アクセス頻度の低いデータを1つのGoogle Cloud Storageバケットに階層化します。
+
--
BlueXPは'各作業環境用にバケットを作成し'fabric-pool-_cluster unique identifier_という名前を付けますボリュームごとに異なるバケットが作成されることはありません。

BlueXPでバケットを作成すると、次のデフォルト設定が使用されます。

* 場所の種類：地域
* ストレージクラス：Standard
* public access：オブジェクトACLに依存します
* アクセスコントロール：きめ細かな設定
* 保護：なし
* データの暗号化：Googleで管理されるキー


--
ストレージクラス:: 階層化データのデフォルトのストレージクラスは、 _Standard Storage_class です。データへのアクセス頻度が低い場合は、 _Nearline Storage_or_Coldline Storage_ に変更することでストレージコストを削減できます。ストレージクラスを変更すると、アクセス頻度の低いデータは選択したクラスに直接移動します。
+
--
データにアクセスするとアクセスコストが高くなるため、ストレージクラスを変更する前にこの点を考慮する必要があります。 https://cloud.google.com/storage/docs/storage-classes["Google Cloud Storage のストレージクラスの詳細については、こちらをご覧ください"^]。

作業環境の作成時にストレージ階層を選択し、あとでいつでも変更できます。ストレージクラスの変更の詳細については、を参照してください link:task-tiering.html["使用頻度の低いデータを低コストのオブジェクトストレージに階層化"]。

データ階層化のストレージクラスは、システム全体に適用されます。ボリューム単位ではありません。

--


endif::gcp[]



== データ階層化と容量の制限

データの階層化を有効にしても、システムの容量制限は変わりません。この制限は、パフォーマンス階層と容量階層に分散されます。



== ボリューム階層化ポリシー

データ階層化を有効にするには、ボリュームの作成、変更、またはレプリケート時にボリューム階層化ポリシーを選択する必要があります。ボリュームごとに異なるポリシーを選択できます。

一部の階層化ポリシーには、最小冷却期間が関連付けられています。この期間は、データを「コールド」と見なして容量階層に移動するために、ボリューム内のユーザーデータを非アクティブのままにする必要がある時間を設定します。クーリング期間は、データがアグリゲートに書き込まれると開始されます。


TIP: 最小クーリング期間とデフォルトのアグリゲートしきい値を 50% に変更できます（詳細については後述します）。 http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-AD522711-01F9-4413-A254-929EAE871EBF.html["冷却期間を変更する方法について説明します"^] および http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-mgng-stor-tier-fp/GUID-8FC4BFD5-F258-4AA6-9FCB-663D42D92CAA.html["しきい値を変更する方法について説明します"^]。

BlueXPでは、ボリュームを作成または変更するときに、次のボリューム階層化ポリシーから選択できます。

Snapshot のみ:: アグリゲートの容量が 50% に達すると、 Cloud Volumes ONTAP は、アクティブなファイルシステムに関連付けられていない Snapshot コピーのコールドユーザデータを容量階層に階層化します。冷却期間は約 2 日間です。
+
--
読み取りの場合、容量階層のコールドデータブロックはホットになり、パフォーマンス階層に移動されます。

--
すべて:: すべてのデータ（メタデータを除く）はすぐにコールドとしてマークされ、オブジェクトストレージにできるだけ早く階層化されます。ボリューム内の新しいブロックがコールドになるまで、 48 時間待つ必要はありません。「すべて」のポリシーが設定される前のボリュームにあるブロックは、コールドになるまで 48 時間かかります。
+
--
読み取られた場合、クラウド階層のコールドデータブロックはコールドのままで、パフォーマンス階層に書き戻されません。このポリシーは ONTAP 9.6 以降で使用できます。

--
自動:: アグリゲートの容量が 50% に達すると、 Cloud Volumes ONTAP はボリューム内のコールドデータブロックを容量階層に階層化します。コールドデータには、 Snapshot コピーだけでなく、アクティブなファイルシステムのコールドユーザデータも含まれます。冷却期間は約 31 日です。
+
--
このポリシーは、 Cloud Volumes ONTAP 9.4 以降でサポートされます。

ランダム読み取りで読み取りを行うと、容量階層のコールドデータブロックがホットになり、パフォーマンス階層に移動します。インデックススキャンやアンチウイルススキャンに関連するようなシーケンシャルリードで読み取られた場合、コールドデータブロックはコールド状態を維持し、パフォーマンス階層には移動しません。

--
なし:: ボリュームのデータをパフォーマンス階層に保持し、容量階層に移動できないようにします。


ボリュームをレプリケートする場合、データをオブジェクトストレージに階層化するかどうかを選択できます。その場合は、データ保護ボリュームに*Backup*ポリシーが適用されます。Cloud Volumes ONTAP 9.6 以降では、「 * all * 」階層化ポリシーがバックアップポリシーに置き換えられます。



=== Cloud Volumes ONTAP をオフにすると、冷却期間に影響します

データブロックはクーリングスキャンによって冷却されます。このプロセスでは、使用されていないブロックのブロック温度が次の低い値に移動（冷却）されます。デフォルトのクーリング時間は、ボリューム階層化ポリシーによって異なります。

* 自動： 31 日
* Snapshot のみ： 2 日


冷却スキャンが機能するためには、 Cloud Volumes ONTAP が実行されている必要があります。Cloud Volumes ONTAP をオフにすると、冷却も停止します。その結果、冷却時間が長くなります。


TIP: Cloud Volumes ONTAP をオフにすると、システムを再起動するまで各ブロックの温度が維持されます。たとえば、システムの電源をオフにしたときにブロックの温度が 5 であっても、システムの電源をオンにしたときの温度は 5 のままです。



== データ階層化の設定

手順およびサポートされている構成の一覧については、を参照してください link:task-tiering.html["使用頻度の低いデータを低コストのオブジェクトストレージに階層化"]。
